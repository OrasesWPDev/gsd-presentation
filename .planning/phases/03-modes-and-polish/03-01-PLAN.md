---
phase: 03-modes-and-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pomodoro-timer/index.html
autonomous: false

must_haves:
  truths:
    - "User clicks Short Break button and timer switches to 5:00"
    - "User clicks Pomodoro button and timer switches to 25:00"
    - "Session counter increments when Pomodoro completes (not breaks)"
    - "Session counter displays prominently below timer"
    - "Mode switching preserves running state"
  artifacts:
    - path: "pomodoro-timer/index.html"
      provides: "Mode switching and session tracking"
      contains: "data-mode"
    - path: "pomodoro-timer/index.html"
      provides: "Session counter display"
      contains: "session-count"
  key_links:
    - from: "mode button click"
      to: "switchMode()"
      via: "data-mode attribute lookup"
      pattern: "btn\\.dataset\\.mode"
    - from: "handleComplete()"
      to: "session counter increment"
      via: "mode check before increment"
      pattern: "timer\\.mode === 'pomodoro'"
---

<objective>
Add mode switching between Pomodoro and Short Break, plus session tracking.

Purpose: Transform the countdown timer into a proper Pomodoro technique tool where users can switch modes and track completed work sessions.
Output: Working mode buttons that switch timer duration, session counter that increments on Pomodoro completion.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-modes-and-polish/03-RESEARCH.md

# Prior phase research for timer structure understanding
@.planning/phases/01-timer-foundation/01-RESEARCH.md
@.planning/phases/02-core-timer-logic/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add mode switching with data-mode buttons</name>
  <files>pomodoro-timer/index.html</files>
  <action>
Update the existing mode buttons in HTML to use data-mode attributes:
- Pomodoro button: `data-mode="pomodoro"`
- Short Break button: `data-mode="shortBreak"`
- Add `active` class to Pomodoro button initially

Add `mode` property to timer state object:
```javascript
timer.mode = 'pomodoro';  // 'pomodoro' | 'shortBreak'
```

Ensure timer durations use property names that match mode strings:
```javascript
timer.pomodoro = 25 * 60;    // 1500 seconds
timer.shortBreak = 5 * 60;   // 300 seconds
```

Create switchMode(mode) function that:
1. Checks if timer was running (`wasRunning = timer.intervalId !== null`)
2. Stops timer if running
3. Sets `timer.mode = mode`
4. Sets `timer.remainingSeconds = timer[mode]` (dynamic property lookup)
5. Updates mode button UI: remove `active` from all, add to clicked button
6. Calls updateDisplay()
7. If wasRunning, calls startTimer() to continue with new duration

Add event listeners to mode buttons using data-mode:
```javascript
document.querySelectorAll('.mode-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    switchMode(btn.dataset.mode);
  });
});
```

CSS for active state: `.mode-btn.active { opacity: 1; font-weight: bold; }`
  </action>
  <verify>
Open index.html in browser:
1. Click "Short Break" - display changes to 05:00
2. Click "Pomodoro" - display changes to 25:00
3. Click Start, wait 2 seconds, click "Short Break" - timer continues from 05:00
  </verify>
  <done>Mode buttons switch timer duration, running state preserved on mode switch</done>
</task>

<task type="auto">
  <name>Task 2: Add session counter with Pomodoro-only increment</name>
  <files>pomodoro-timer/index.html</files>
  <action>
Add session counter to timer state:
```javascript
timer.sessions = 0;
```

Add HTML element for session display below the timer:
```html
<div id="session-count" class="session-count">Pomodoros completed: 0</div>
```

CSS for prominent display:
```css
.session-count {
  font-size: 1.2rem;
  margin-top: 1rem;
  color: var(--text-color);
}
```

Create updateSessionDisplay() function:
```javascript
function updateSessionDisplay() {
  document.getElementById('session-count').textContent =
    `Pomodoros completed: ${timer.sessions}`;
}
```

Modify handleComplete() to increment sessions ONLY when Pomodoro completes:
```javascript
function handleComplete() {
  // Only count completed Pomodoros, NOT breaks
  if (timer.mode === 'pomodoro') {
    timer.sessions++;
    updateSessionDisplay();
  }

  stopTimer();
  timer.remainingSeconds = 0;
  updateDisplay();

  // Auto-switch mode after completion
  const nextMode = timer.mode === 'pomodoro' ? 'shortBreak' : 'pomodoro';
  switchMode(nextMode);
}
```

Call updateSessionDisplay() on page load to initialize display.
  </action>
  <verify>
Test session counting:
1. Set timer.pomodoro = 3 (3 seconds) temporarily for quick test
2. Start timer, wait for completion
3. Verify "Pomodoros completed: 1" displays
4. Verify timer auto-switched to Short Break mode
5. Complete Short Break - verify counter stays at 1 (not 2)
6. Complete another Pomodoro - verify counter shows 2
  </verify>
  <done>Session counter increments only on Pomodoro completion, displays prominently</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete mode switching and session tracking for Pomodoro timer</what-built>
  <how-to-verify>
Open pomodoro-timer/index.html in browser and test:

1. **Mode switching (static)**
   - Click "Short Break" - display shows 05:00
   - Click "Pomodoro" - display shows 25:00
   - Active button should be visually distinct

2. **Mode switching (while running)**
   - Click Start on Pomodoro
   - Wait 2-3 seconds
   - Click "Short Break" - timer should restart at 05:00 and keep running
   - Click "Pomodoro" - timer should restart at 25:00 and keep running

3. **Session counter**
   - For quick testing: Open DevTools console, run `timer.pomodoro = 3`
   - Click Reset, then Start
   - Timer counts down 3 seconds and completes
   - Verify "Pomodoros completed: 1" appears
   - Timer should auto-switch to Short Break
   - Run `timer.shortBreak = 2` in console
   - Click Reset, then Start
   - Complete the break
   - Verify counter is still 1 (breaks don't count)

4. **Visual polish**
   - Session counter is readable and prominent (below timer)
   - Active mode button is clearly distinguishable
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
All success criteria from ROADMAP.md verified:
1. User clicks "Short Break" button and timer switches to 5:00 countdown
2. User clicks "Pomodoro" button and timer switches back to 25:00 countdown
3. Session counter increments when Pomodoro completes (reaches 00:00)
4. Session counter displays "Pomodoros completed: X" prominently
5. Mode switching preserves timer state (if running, keeps running with new duration)
</verification>

<success_criteria>
- Mode buttons with data-mode attributes work correctly
- switchMode() function handles running state preservation
- Session counter only increments on Pomodoro completion
- Session display is prominent and updates in real-time
- All TIMER-05 and TIMER-06 requirements satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/03-modes-and-polish/03-01-SUMMARY.md`
</output>
